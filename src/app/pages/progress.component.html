<h1>Progress</h1>
<hr/>
<table mat-table [dataSource]="(progress$ | async) || []" class="mat-elevation-z8">
  <!-- Title Column -->
  <ng-container matColumnDef="title">
    <th mat-header-cell *matHeaderCellDef>Title</th>
    <td mat-cell *matCellDef="let progress">
      {{ progress.book?.title }}
    </td>
  </ng-container>

  <!-- Progress Column -->
  <ng-container matColumnDef="progress">
    <th mat-header-cell *matHeaderCellDef>Progress</th>
    <td mat-cell *matCellDef="let progress">
      <mat-progress-bar 
        mode="determinate" 
        [value]="(progress.currentPage / progress.book.totalPages) * 100">
      </mat-progress-bar>
      <span>
        {{
          progress.book?.totalPages
            ? ((progress.currentPage / progress.book.totalPages) * 100 | number:'2.0-0')
            : 0
        }}%
      </span>
    </td>
  </ng-container>

   <!-- Status Column -->
  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef>Last Read at</th>
    <td mat-cell *matCellDef="let progress">
      {{ progress.last_read_at | date:'medium':'GMT+8' }}
    </td>
  </ng-container> 

  <ng-container matColumnDef="action">
    <th mat-header-cell *matHeaderCellDef>Action</th>
    <td mat-cell *matCellDef="let progress">
      <button
        mat-button
        color="primary"
        [routerLink]="['/books', progress.bookId, 'read']"
        [queryParams]="{ page: progress.currentPage }"
      >
        Read
      </button>

    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>
